webpackJsonp([30],{EEoi:function(e,t){},"Q9+n":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),c=i.n(s),n=i("Dd8w"),a=i.n(n),l=i("NYxO"),r={name:"distributionTemplate",created:function(){this.initView()},data:function(){return{visSelect:!1,tplLayer:{show:!1,title:"",inputName:"",inputDesc:"",radioType:1,index:0,cityArr:[{name:"华东",cities:[{name:"上海",id:"310000"},{name:"江苏",id:"320000"},{name:"浙江",id:"330000"},{name:"安徽",id:"340000"},{name:"山东",id:"370000"},{name:"福建",id:"350000"},{name:"江西",id:"360000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"华北",cities:[{name:"北京",id:"110000"},{name:"天津",id:"120000"},{name:"河北",id:"130000"},{name:"山西",id:"140000"},{name:"内蒙古",id:"150000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"华中",cities:[{name:"湖北",id:"420000"},{name:"湖南",id:"430000"},{name:"河南",id:"410000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"华南",cities:[{name:"广东",id:"440000"},{name:"广西",id:"450000"},{name:"海南",id:"460000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"东北",cities:[{name:"辽宁",id:"210000"},{name:"吉林",id:"220000"},{name:"黑龙江",id:"230000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"西北",cities:[{name:"宁夏",id:"640000"},{name:"新疆",id:"650000"},{name:"青海",id:"630000"},{name:"陕西",id:"610000"},{name:"甘肃",id:"620000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1},{name:"西南",cities:[{name:"四川",id:"510000"},{name:"云南",id:"530000"},{name:"贵州",id:"520000"},{name:"西藏",id:"540000"},{name:"重庆",id:"500000"}],checkAll:!1,checkedCities:[],isIndeterminate:!1}],exceptList:[],filteredProvinceList:[]},limitAreaNameList:[],exceptAreaNameList:[],localAllCity:{provinceList:[],cityList:[],districtList:[]},dialogVisible:!1,index:null,distributionListName:"",distributionList:[]}},computed:a()({},Object(l.mapState)(["allCity"])),methods:a()({},Object(l.mapActions)(["getDistributionTemplate","deleteDeliverTpl","saveDeliverTpl","getAllCity","callSetNotice"]),{visibleSelectLevel:function(e){this.visSelect=!0},showTplLayer:function(e){if("number"!=typeof e&&this.distributionList.length>4)return this.getNotice("配送模板最多只允许存在五个"),!1;if(document.body.setAttribute("style","overflow:hidden"),this.index="number"==typeof e?e:null,this.tplLayer.title=null===this.index?"新增配送模板":"修改配送模板",this.tplLayer.show=!0,"number"==typeof e){var t=this.distributionList[e];this.tplLayer.inputName=t.name,this.tplLayer.inputDesc=t.desc,this.tplLayer.radioType=t.type;var i=this;i.tplLayer.cityArr.map(function(e,t){e.checkedCities=[]}),t.limitAreaList.map(function(e,t){i.tplLayer.cityArr.map(function(t,i){t.cities.map(function(i,s){i.id==e.provinceCode&&t.checkedCities.push(i)}),t.checkAll=t.cities.length==t.checkedCities.length})}),i.tplLayer.exceptList=[],t.exceptAreaList.map(function(e,t){i.tplLayer.exceptList.push({selectedProvince:e.provinceCode?i.codeTransName(e.provinceCode,1):"",selectedCity:e.cityCode?i.codeTransName(e.cityCode,2):"",selectedDistrict:e.districtCode?i.codeTransName(e.districtCode,3):"",cityShow:!0,districtShow:!0,localAllCity:{provinceList:i.tplLayer.filteredProvinceList,cityList:i.getInitSelectOpts(e.provinceCode,1),districtList:i.getInitSelectOpts(e.cityCode,2)}})}),this.filteredProvince()}else this.tplLayer.inputName="",this.tplLayer.inputDesc="",this.tplLayer.radioType=1,this.tplLayer.cityArr.map(function(e,t){e.checkedCities=[]}),this.tplLayer.exceptList=[]},cancelTpl:function(){document.body.removeAttribute("style"),this.tplLayer.cityArr.map(function(e){e.checkAll=!1,e.checkedCities=[],e.isIndeterminate=!1}),this.visSelect=!1,this.tplLayer.show=!1},initView:function(){var e=this;!localStorage.getItem("allCityStorage")||localStorage.getItem("allCityStorage").length<1e4?this.getAllCity().then(function(){localStorage.setItem("allCityStorage",c()(e.allCity.data)),e.changeList()}):this.changeList()},changeList:function(){var e=this,t=JSON.parse(localStorage.getItem("allCityStorage"));this.localAllCity.provinceList=t.provinceList,this.localAllCity.cityList=t.cityList,this.localAllCity.districtList=t.districtList,e.limitAreaNameList=[],e.exceptAreaNameList=[],this.getDistributionTemplate().then(function(i){e.distributionList=i,e.distributionList.map(function(i,s){var c="",n="",a=0,l=0,r=0,o=0;i.limitAreaList.map(function(e,i){for(;t.provinceList[a].provinceId!==e.provinceCode;)a++;c+=t.provinceList[a].name+" ",a=0}),e.limitAreaNameList.push(c),i.exceptAreaList.map(function(e,i){if(e.provinceCode){for(;t.provinceList[l].provinceId!==e.provinceCode;)l++;n+=t.provinceList[l].name}if(e.cityCode){for(;t.cityList[r].cityId!==e.cityCode;)r++;n+=t.cityList[r].name}if(e.districtCode){for(;t.districtList[o].districtId!==e.districtCode&&++o!=t.districtList.length;);n+=o==t.districtList.length?"":t.districtList[o].name}n+=" ",l=r=o=0}),e.exceptAreaNameList.push(n)})})},deleteTpl:function(e){this.index=e,this.distributionListName=this.distributionList[e].name,this.dialogVisible=!0},getInitSelectOpts:function(e,t){var i=JSON.parse(localStorage.getItem("allCityStorage")),s=1==t?"provinceId":"cityId";return i[1==t?"cityList":"districtList"].filter(function(t,i){if(t[s]==e)return t})},changeProvinve:function(e){var t=JSON.parse(localStorage.getItem("allCityStorage")),i=this.tplLayer.exceptList[e];i.localAllCity.cityList=t.cityList.filter(function(e,t){if(e.provinceId==i.selectedProvince)return e}),this.visSelect&&(i.selectedCity="",i.selectedDistrict="")},changeCity:function(e){var t=JSON.parse(localStorage.getItem("allCityStorage")),i=this.tplLayer.exceptList[e];i.localAllCity.districtList=t.districtList.filter(function(e,t){if(e.cityId==i.selectedCity)return e}),this.visSelect&&(i.selectedDistrict="")},addOneExceptArea:function(){this.tplLayer.exceptList.push({selectedProvince:"",selectedCity:"",selectedDistrict:"",cityShow:!0,districtShow:!0,localAllCity:{provinceList:this.tplLayer.filteredProvinceList,cityList:[],districtList:[]}})},deleteOneExceptArea:function(e){this.tplLayer.exceptList.splice(e,1)},saveTpl:function(){var e=this,t=this.tplLayer.cityArr,i=[],s=[],c=this;if(!this.tplLayer.inputName)return this.getNotice("请输入运费模板名称"),!1;if(!this.tplLayer.inputDesc)return this.getNotice("请输入运费模板描述"),!1;t.map(function(e,t){e.checkedCities.map(function(e,t){i.push({provinceCode:e.id,cityCode:1,districtCode:1})})}),this.tplLayer.exceptList.map(function(e,t){var i={provinceCode:e.selectedProvince.match(/^\d*$/g)?e.selectedProvince:c.nameTransCode(e.selectedProvince,1),cityCode:e.selectedCity.match(/^\d*$/g)?e.selectedCity:c.nameTransCode(e.selectedCity,2),districtCode:e.selectedDistrict.match(/^\d*$/g)?e.selectedDistrict:c.nameTransCode(e.selectedDistrict,3)};i.provinceCode=i.provinceCode?i.provinceCode:1,i.cityCode=i.cityCode?i.cityCode:1,i.districtCode=i.districtCode?i.districtCode:1,s.push(i)});var n={id:null===this.index?"":this.distributionList[this.index].id,name:this.tplLayer.inputName,desc:this.tplLayer.inputDesc,type:this.tplLayer.radioType,limitAreaList:i,exceptAreaList:s};this.saveDeliverTpl(n).then(function(){e.changeList(),e.cancelTpl()})},confirmDelete:function(){var e=this;this.deleteDeliverTpl({templateId:this.distributionList[this.index].id}).then(function(){e.changeList(),e.dialogVisible=!1})},handleCheckAllChange:function(e,t){var i=this.tplLayer.cityArr[e];i.checkedCities=t.target.checked?i.cities:[],i.isIndeterminate=!1,this.filteredProvince()},handleCheckedCitiesChange:function(e){var t=this.tplLayer.cityArr[e],i=t.checkedCities.length;t.checkAll=i===t.cities.length,t.isIndeterminate=i>0&&i<t.cities.length,this.filteredProvince()},filteredProvince:function(){var e=this,t=[];this.tplLayer.cityArr.map(function(e,i){e.checkedCities.map(function(e,i){t.push(e.id)})}),this.tplLayer.filteredProvinceList=this.localAllCity.provinceList.filter(function(e,i){for(var s=0,c=t.length;s<c;s++)if(t[s]==e.provinceId)return e});var i=[];this.tplLayer.exceptList.map(function(t,s){var c=t.selectedProvince.match(/^\d*$/g)?t.selectedProvince:e.nameTransCode(t.selectedProvince,1),n=!1;e.tplLayer.cityArr.map(function(e){e.checkedCities.map(function(e){e.id==c&&(n=!0)})}),n||i.push(s)}),this.tplLayer.exceptList=this.tplLayer.exceptList.filter(function(e,t){var s=!0;return i.map(function(e){t==e&&(s=!1)}),s})},codeTransName:function(e,t){var i=JSON.parse(localStorage.getItem("allCityStorage")),s=0;switch(t){case 1:for(;e!=i.provinceList[s].provinceId;)s++;return i.provinceList[s].name;case 2:for(;e!=i.cityList[s].cityId;)s++;return i.cityList[s].name;case 3:for(;e!=i.districtList[s].districtId&&++s!=i.districtList.length;);return s==i.districtList.length?"":i.districtList[s].name}},nameTransCode:function(e,t){var i=JSON.parse(localStorage.getItem("allCityStorage")),s=0;switch(t){case 1:for(;e!=i.provinceList[s].name;)s++;return i.provinceList[s].provinceId;case 2:for(;e!=i.cityList[s].name;)s++;return i.cityList[s].cityId;case 3:for(;e!=i.districtList[s].name;)s++;return i.districtList[s].districtId}},getNotice:function(e){var t={isShow:!0,msg:e};this.callSetNotice(t)}})},o=i("XBvH"),d=i.n(o);var p=function(e){i("EEoi")},v=i("VU/8")(r,d.a,!1,p,"data-v-cc2f1206",null);t.default=v.exports},XBvH:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e._m(0),e._v(" "),i("p",{staticClass:"btn-wrap"},[i("el-button",{attrs:{type:"primary"},on:{click:e.showTplLayer}},[e._v("新增配送模板")])],1),e._v(" "),i("div",{staticClass:"section"},e._l(e.distributionList,function(t,s){return i("div",{key:s,staticClass:"section-item"},[i("div",{staticClass:"block-item o-h"},[i("span",[e._v("模板名称："+e._s(t.name))]),e._v(" "),i("el-button",{staticClass:"fl-r",attrs:{type:"primary",size:"small"},on:{click:function(t){e.deleteTpl(s)}}},[e._v("删除")]),e._v(" "),i("el-button",{staticClass:"fl-r",staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.showTplLayer(s)}}},[e._v("修改")])],1),e._v(" "),i("div",{staticClass:"block-item"},[1==t.type?i("span",[e._v("限制类型：仅发以下地区")]):2==t.type?i("span",[e._v("限制类型：以下地区不发货")]):3==t.type?i("span",[e._v("限制类型：限制仅发货省份中的不发货区县")]):e._e()]),e._v(" "),i("div",{staticClass:"block-item"},[i("span",[e._v("限制地区："+e._s(e.limitAreaNameList[s]))])]),e._v(" "),t.exceptAreaList&&t.exceptAreaList.length>0?i("div",{staticClass:"block-item"},[i("span",[e._v("例外地区："+e._s(e.exceptAreaNameList[s]))])]):e._e(),e._v(" "),i("div",{staticClass:"block-item"},[i("span",[e._v("模板描述："+e._s(t.desc))])])])})),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.tplLayer.show,expression:"tplLayer.show"}],staticClass:"layer-bg tpl-layer"},[i("div",{staticClass:"price-ct"},[i("h1",[e._v(e._s(e.tplLayer.title))]),e._v(" "),i("div",{staticClass:"input-ct"},[i("p",[i("span",[e._v("模板名称：")]),e._v(" "),i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.tplLayer.inputName,callback:function(t){e.$set(e.tplLayer,"inputName",t)},expression:"tplLayer.inputName"}})],1),e._v(" "),i("p",[i("span",[e._v("限制类型：")]),e._v(" "),i("el-radio-group",{model:{value:e.tplLayer.radioType,callback:function(t){e.$set(e.tplLayer,"radioType",t)},expression:"tplLayer.radioType"}},[i("el-radio",{attrs:{label:1}},[e._v("仅发以下地区")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("以下地区不发货")])],1)],1),e._v(" "),e._m(1),e._v(" "),e._l(e.tplLayer.cityArr,function(t,s){return i("p",{key:s},[[i("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(t){e.handleCheckAllChange(s,t)}},model:{value:t.checkAll,callback:function(i){e.$set(t,"checkAll",i)},expression:"obj.checkAll"}},[e._v(e._s(t.name))]),e._v(" "),i("el-checkbox-group",{on:{change:function(t){e.handleCheckedCitiesChange(s)}},model:{value:t.checkedCities,callback:function(i){e.$set(t,"checkedCities",i)},expression:"obj.checkedCities"}},e._l(t.cities,function(t,s){return i("el-checkbox",{key:t.id,attrs:{label:t}},[e._v(e._s(t.name))])}))]],2)}),e._v(" "),i("p",[i("span",[e._v("例外地区：")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.addOneExceptArea}},[e._v("添加")])],1),e._v(" "),e._l(e.tplLayer.exceptList,function(t,s){return i("p",{key:s},[i("el-select",{attrs:{placeholder:"省"},on:{"visible-change":e.visibleSelectLevel,change:function(t){e.changeProvinve(s)}},model:{value:t.selectedProvince,callback:function(i){e.$set(t,"selectedProvince",i)},expression:"oneExcept.selectedProvince"}},e._l(e.tplLayer.filteredProvinceList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.provinceId}})})),e._v(" "),i("el-select",{directives:[{name:"show",rawName:"v-show",value:t.cityShow,expression:"oneExcept.cityShow"}],attrs:{placeholder:"市"},on:{"visible-change":e.visibleSelectLevel,change:function(t){e.changeCity(s)}},model:{value:t.selectedCity,callback:function(i){e.$set(t,"selectedCity",i)},expression:"oneExcept.selectedCity"}},e._l(t.localAllCity.cityList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.cityId}})})),e._v(" "),i("el-select",{directives:[{name:"show",rawName:"v-show",value:t.districtShow,expression:"oneExcept.districtShow"}],attrs:{placeholder:"区"},on:{"visible-change":e.visibleSelectLevel},model:{value:t.selectedDistrict,callback:function(i){e.$set(t,"selectedDistrict",i)},expression:"oneExcept.selectedDistrict"}},e._l(t.localAllCity.districtList,function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.districtId}})})),e._v(" "),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.deleteOneExceptArea(s)}}},[e._v("删除")])],1)}),e._v(" "),i("p",[i("span",[e._v("模板描述：")]),e._v(" "),i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.tplLayer.inputDesc,callback:function(t){e.$set(e.tplLayer,"inputDesc",t)},expression:"tplLayer.inputDesc"}})],1)],2),e._v(" "),i("div",{staticClass:"btns-wrap"},[i("el-button",{attrs:{type:"primary"},on:{click:e.saveTpl}},[e._v("确 定")]),e._v(" "),i("el-button",{on:{click:e.cancelTpl}},[e._v("取 消")])],1)])]),e._v(" "),i("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,size:"tiny"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",[e._v("确定删除【"+e._s(e.distributionListName)+"】模板？")]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.confirmDelete}},[e._v("确 定")])],1)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title"},[t("span",[this._v("管理配送模板")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("span",[this._v("限制地区：")])])}]}}});
//# sourceMappingURL=30.4a5f1163aee1af3ddfae.js.map