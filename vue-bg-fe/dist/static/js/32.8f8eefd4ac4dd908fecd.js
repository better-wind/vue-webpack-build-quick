webpackJsonp([32],{XtNR:function(t,e){},bow7:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("mvHQ"),n=o.n(i),l=o("Dd8w"),c=o.n(l),s=o("NYxO"),a={name:"authority",created:function(){this.initView()},data:function(){var t=this,e=function(t,e,o){""===e?o(new Error("请输入密码")):e.match(/^[a-zA-Z0-9]{6,12}$/g)?o():o(new Error("密码6-12位字母或数字组成"))};return{dialogClose:!1,changePwdConfig:{isModal:!1,type:"",opts:{accountId:"",oldPassword:"",newPassword:"",confirmPassword:""}},changePwdConfigRules:{oldPassword:[{required:!0,message:"请输入密码",trigger:"blur"}],newPassword:[{required:!0,validator:e,trigger:"blur"}],confirmPassword:[{required:!0,validator:function(e,o,i){""===o?i(new Error("请再次输入密码")):o!==t.changePwdConfig.opts.newPassword?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"}]},mapTree:{},treeList:[],defaultProps:{children:"children",label:"label"},roleEditConfig:{isModal:!1,opts:{id:"",roleName:"",roleDesc:"",roleFunctionRelations:[]},sellerRoleId:"",defaultChecked:[]},roleEditConfigRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleDesc:[{required:!0,message:"请输入角色描述",trigger:"blur"}],roleFunctionRelations:[{required:!0,validator:function(e,o,i){t.roleEditConfig.opts.roleFunctionRelations.length<1?i(new Error("请选择权限")):i()},trigger:"change"}]},accountRoleConfig:{isModal:!1,id:"",type:"",opts:{edit:{id:"",accountRoleRelations:[]},add:{username:"",password:"",remark:"",accountRoleRelations:[]}},checkList:[]},accountRoleConfigRules:{username:[{required:!0,message:"请输入账户名",trigger:"blur"}],password:[{required:!0,validator:e,trigger:"blur"}],remark:[{required:!0,validator:function(e,o,i){""===o?i(new Error("请再次输入密码")):o!==t.accountRoleConfig.opts.add.password?i(new Error("两次输入密码不一致!")):i()},trigger:"blur"}],accountRoleRelations:[{required:!0,validator:function(e,o,i){t.accountRoleConfig.checkList.length<1?i(new Error("请选择角色")):i()},trigger:"change"}]},roleCheckOptions:[],mapRoleID:{},accountListFilter:[],roleClick:!1,accountRoleList:[],accountFunList:[]}},computed:c()({},Object(s.d)(["loginCheck","sellerInfo"])),methods:c()({},Object(s.b)(["getAccountList","changeAccountPwd","getAccountRoleList","getAccountFunctionList","saveAccountRole","delAccountRole","addAccount","changeAccountRole","delAccount","callSetNotice"]),{initView:function(){var t=this;this.getAccountFunctionList().then(function(e){t.accountFunList=e,t.setFunList()}),this.callGetAccountRoleList(),this.callGetAccountList()},callGetAccountList:function(){var t=this;this.getAccountList().then(function(e){var o=JSON.parse(n()(e));t.accountListFilter=o.filter(function(e){return t.loginCheck.id!=e.id})})},callGetAccountRoleList:function(){var t=this;this.getAccountRoleList().then(function(e){for(var o in t.accountRoleList=e,t.roleCheckOptions=[],t.accountRoleList){var i={id:t.accountRoleList[o].id,roleName:t.accountRoleList[o].roleName};t.mapRoleID[t.accountRoleList[o].id+""]=t.accountRoleList[o].roleName,t.roleCheckOptions.push(i)}})},setFunList:function(){var t=[];for(var e in this.accountFunList)if(this.mapTree[this.accountFunList[e].id]=this.accountFunList[e].functionName,0==this.accountFunList[e].parentId){var o={id:this.accountFunList[e].id,label:this.accountFunList[e].functionName,children:[]};this.treeList.push(o)}else t.push(this.accountFunList[e]);for(var i in t)for(var n in this.treeList)if(t[i].parentId==this.treeList[n].id){var l={id:t[i].id,label:t[i].functionName};this.treeList[n].children.push(l)}},cancelChangePwd:function(){this.changePwdConfig.isModal=!1,this.changePwdConfig.opts={accountId:"",oldPassword:"",newPassword:"",confirmPassword:""}},submitChangePwd:function(t){var e=this,o=!1;if(this.$refs[t].validate(function(t){if(!t)return o=!1,!1;o=!0}),!o)return!1;var i={accountId:this.changePwdConfig.opts.accountId,oldPassword:this.changePwdConfig.opts.oldPassword,newPassword:this.changePwdConfig.opts.newPassword};this.changeAccountPwd(i).then(function(){e.cancelChangePwd()})},changePwd:function(t,e){this.changePwdConfig.isModal=!0,this.changePwdConfig.opts={accountId:t,oldPassword:e,newPassword:"",confirmPassword:""},this.changePwdConfig.type=e?"":"Main"},callDelRole:function(t){var e=this,o={roleId:t};this.$confirm("是否删除角色","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){e.delAccountRole(o).then(function(){e.callGetAccountRoleList()})}).catch(function(){})},callEditRole:function(t){if(t){var e=[],o={};for(var i in this.treeList.map(function(t){t.children.length&&(o[t.id]=t.children)}),t.roleFunctionRelations)if(!o[t.roleFunctionRelations[i].sellerFuncId]){var n={id:t.roleFunctionRelations[i].sellerFuncId,label:this.mapTree[t.roleFunctionRelations[i].sellerFuncId]};e.push(n)}this.roleEditConfig.opts={id:t.id,roleName:t.roleName,roleDesc:t.roleDesc,roleFunctionRelations:[]},this.roleEditConfig.sellerRoleId=t.id,this.roleEditConfig.isModal=!0;var l=this;setTimeout(function(){l.$refs.tree.setCheckedNodes(e)},100)}else{this.roleEditConfig.opts={id:"",roleName:"",roleDesc:"",roleFunctionRelations:[]},this.roleEditConfig.sellerRoleId="",this.roleEditConfig.isModal=!0;var c=this;setTimeout(function(){c.$refs.tree.setCheckedNodes([])},10)}},cancelRole:function(){this.roleEditConfig.opts={id:"",roleName:"",roleDesc:"",roleFunctionRelations:[]},this.roleEditConfig.sellerRoleId="",this.$refs.tree.setCheckedNodes([]),this.$refs["roleEditConfig.opts"].resetFields(),this.roleEditConfig.isModal=!1},submitRole:function(t){var e=this,o=!1;if(this.$refs[t].validate(function(t){if(!t)return o=!1,!1;o=!0}),!o)return!1;var i={};this.roleEditConfig.opts.roleFunctionRelations.map(function(t){i[t.sellerFuncId]=t.sellerFuncId});var n={};for(var l in this.treeList.map(function(t){t.children.length&&t.children.map(function(e){i[e.id]&&!i[t.id]&&(n[t.id]=t.id)})}),n){var c={sellerRoleId:this.roleEditConfig.opts.roleFunctionRelations[0].sellerRoleId,sellerFuncId:n[l]};this.roleEditConfig.opts.roleFunctionRelations.push(c)}this.saveAccountRole(this.roleEditConfig.opts).then(function(){e.callGetAccountRoleList(),e.cancelRole()})},checkedTree:function(t,e,o){if(e){var i={sellerRoleId:this.roleEditConfig.sellerRoleId,sellerFuncId:t.id};this.roleEditConfig.opts.roleFunctionRelations.push(i)}if(!e){var n=this.roleEditConfig.opts.roleFunctionRelations.findIndex(function(e){return e.sellerFuncId==t.id});n>-1&&this.roleEditConfig.opts.roleFunctionRelations.splice(n,1)}},cancelEditAccount:function(){this.accountRoleConfig.type="",this.accountRoleConfig.id="",this.accountRoleConfig.opts.add.accountRoleRelations=[],this.accountRoleConfig.opts.edit.accountRoleRelations=[],this.accountRoleConfig.isModal=!1},callEditAccount:function(t){if(this.accountRoleConfig.checkList=[],t){for(var e in this.accountRoleConfig.type="edit",this.accountRoleConfig.id=t.id,t.accountRoleRelations)for(var o in this.accountRoleList)t.accountRoleRelations[e].sellerRoleId==this.accountRoleList[o].id&&this.accountRoleConfig.checkList.push(this.accountRoleList[o].roleName);this.accountRoleConfig.opts.add.accountRoleRelations=this.accountRoleConfig.checkList,this.accountRoleConfig.opts.edit.accountRoleRelations=this.accountRoleConfig.checkList}else this.accountRoleConfig.type="add";this.accountRoleConfig.isModal=!0},submitEditAccount:function(t){var e=this,o=!1,i=[];for(var n in this.accountRoleConfig.checkList)for(var l in this.accountRoleList)if(this.accountRoleConfig.checkList[n]==this.accountRoleList[l].roleName){var c={id:"",sellerAccountId:this.accountRoleConfig.id,sellerRoleId:this.accountRoleList[l].id};i.push(c)}if(this.accountRoleConfig.opts.add.accountRoleRelations=i,this.accountRoleConfig.opts.edit.accountRoleRelations=i,this.$refs[t].validate(function(t){if(!t)return o=!1,!1;o=!0}),!o)return!1;var s=this.accountRoleConfig.type;if("add"==s){var a={username:this.accountRoleConfig.opts.add.username,password:this.accountRoleConfig.opts.add.password,remark:this.accountRoleConfig.opts.add.remark,accountRoleRelations:i};this.addAccount(a).then(function(){e.callGetAccountList(),e.cancelEditAccount()})}else if("edit"==s){var r={id:this.accountRoleConfig.id,accountRoleRelations:i};this.changeAccountRole(r).then(function(){e.callGetAccountList(),e.cancelEditAccount()})}},callDelAccount:function(t,e){var o=this,i={accountId:t};this.$confirm("是否删除账号 "+e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){o.delAccount(i).then(function(){o.callGetAccountList()})}).catch(function(){})},getNotice:function(t){var e={isShow:!0,msg:t};this.callSetNotice(e)}})},r={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t._m(0),t._v(" "),o("div",{staticClass:"section"},[o("div",{staticClass:"section-item padding"},[t._m(1),t._v(" "),o("div",{staticClass:"block-item"},[t._v("\n        账号:"+t._s(t.loginCheck.username)+"\n      ")]),t._v(" "),o("div",{staticClass:"block-item"},[t._v("\n        密码:\n        "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.changePwd(t.loginCheck.id,"")}}},[t._v("修改密码")])],1)]),t._v(" "),o("div",{staticClass:"section-item"},[o("div",{staticClass:"section-title"},[o("span",[t._v("角色设置")]),t._v(" "),o("div",{staticClass:"block-item"},[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.callEditRole()}}},[t._v("新增角色")])],1)]),t._v(" "),o("div",{staticClass:"modal"},[o("el-dialog",{attrs:{size:"tiny",title:"角色编辑",visible:t.roleEditConfig.isModal},on:{close:function(e){t.cancelRole()},"update:visible":function(e){t.$set(t.roleEditConfig,"isModal",e)}}},[o("el-form",{ref:"roleEditConfig.opts",attrs:{model:t.roleEditConfig.opts,rules:t.roleEditConfigRules}},[o("el-form-item",{attrs:{label:"角色",prop:"roleName","label-width":"80px"}},[o("el-input",{attrs:{placeholder:"角色名称","auto-complete":"off"},model:{value:t.roleEditConfig.opts.roleName,callback:function(e){t.$set(t.roleEditConfig.opts,"roleName",e)},expression:"roleEditConfig.opts.roleName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"描述",prop:"roleDesc","label-width":"80px"}},[o("el-input",{attrs:{placeholder:"角色描述","auto-complete":"off"},model:{value:t.roleEditConfig.opts.roleDesc,callback:function(e){t.$set(t.roleEditConfig.opts,"roleDesc",e)},expression:"roleEditConfig.opts.roleDesc"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"权限",prop:"roleFunctionRelations","label-width":"80px"}},[o("el-tree",{ref:"tree",attrs:{data:t.treeList,"show-checkbox":"","node-key":"id",props:t.defaultProps,"auto-complete":"off"},on:{"check-change":t.checkedTree}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.cancelRole()}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitRole("roleEditConfig.opts")}}},[t._v("确 定")])],1)],1)],1)]),t._v(" "),o("div",{staticClass:"result-view"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.accountRoleList}},[o("el-table-column",{attrs:{prop:"roleName",label:"角色",width:"340",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{prop:"roleDesc",label:"描述",width:"340",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(o){t.callEditRole(e.row)}}},[t._v("编辑")]),t._v(" "),o("el-button",{attrs:{size:"small"},on:{click:function(o){t.callDelRole(e.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),o("div",{staticClass:"section-item"},[o("div",{staticClass:"section-title"},[o("span",[t._v("其他账号设置")]),t._v(" "),o("div",{staticClass:"block-item"},[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.callEditAccount()}}},[t._v("新增账号")])],1)])]),t._v(" "),o("div",{staticClass:"result-view"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:t.accountListFilter}},[o("el-table-column",{attrs:{prop:"username",label:"账号",width:"340",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{prop:"accountRoleRelations",label:"角色",width:"340",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.accountRoleRelations,function(e){return o("span",[t._v(t._s(t.mapRoleID[e.sellerRoleId+""])+"  ")])})}}])}),t._v(" "),o("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(o){t.callEditAccount(e.row)}}},[t._v("配置角色")]),t._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(o){t.changePwd(e.row.id,e.row.password)}}},[t._v("修改密码")]),t._v(" "),o("el-button",{attrs:{size:"small"},on:{click:function(o){t.callDelAccount(e.row.id,e.row.username)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),o("div",{staticClass:"modal"},[o("el-dialog",{attrs:{size:"tiny",title:"账户编辑",visible:t.accountRoleConfig.isModal},on:{"update:visible":function(e){t.$set(t.accountRoleConfig,"isModal",e)},close:function(e){t.cancelEditAccount()}}},["add"==t.accountRoleConfig.type?o("el-form",{ref:"accountRoleConfig.opts.add",attrs:{model:t.accountRoleConfig.opts.add,rules:t.accountRoleConfigRules}},[o("el-form-item",{attrs:{label:"账户",prop:"username","label-width":"100px"}},[o("el-input",{attrs:{placeholder:"请填写","auto-complete":"off"},model:{value:t.accountRoleConfig.opts.add.username,callback:function(e){t.$set(t.accountRoleConfig.opts.add,"username",e)},expression:"accountRoleConfig.opts.add.username"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"密码",prop:"password","label-width":"100px"}},[o("el-input",{attrs:{type:"password",placeholder:"请填写","auto-complete":"off"},model:{value:t.accountRoleConfig.opts.add.password,callback:function(e){t.$set(t.accountRoleConfig.opts.add,"password",e)},expression:"accountRoleConfig.opts.add.password"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"确认密码",prop:"remark","label-width":"100px"}},[o("el-input",{attrs:{type:"password",placeholder:"请填写","auto-complete":"off"},model:{value:t.accountRoleConfig.opts.add.remark,callback:function(e){t.$set(t.accountRoleConfig.opts.add,"remark",e)},expression:"accountRoleConfig.opts.add.remark"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"角色",prop:"accountRoleRelations","label-width":"100px"}},[o("el-checkbox-group",{model:{value:t.accountRoleConfig.checkList,callback:function(e){t.$set(t.accountRoleConfig,"checkList",e)},expression:"accountRoleConfig.checkList"}},[t._l(t.roleCheckOptions,function(t,e){return[o("el-checkbox",{attrs:{label:t.roleName}})]})],2)],1)],1):o("el-form",{ref:"accountRoleConfig.opts.edit",attrs:{model:t.accountRoleConfig.opts.edit,rules:t.accountRoleConfigRules}},[o("el-form-item",{attrs:{prop:"accountRoleRelations",label:"角色","label-width":"100px"}},[o("el-checkbox-group",{model:{value:t.accountRoleConfig.checkList,callback:function(e){t.$set(t.accountRoleConfig,"checkList",e)},expression:"accountRoleConfig.checkList"}},[t._l(t.roleCheckOptions,function(t,e){return[o("el-checkbox",{attrs:{label:t.roleName}})]})],2)],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.cancelEditAccount()}}},[t._v("取 消")]),t._v(" "),"add"==t.accountRoleConfig.type?o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitEditAccount("accountRoleConfig.opts.add")}}},[t._v("确 定")]):o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitEditAccount("accountRoleConfig.opts.edit")}}},[t._v("确 定")])],1)],1)],1),t._v(" "),o("div",{staticClass:"modal"},[o("el-dialog",{attrs:{size:"tiny",title:"修改密码",visible:t.changePwdConfig.isModal},on:{"update:visible":function(e){t.$set(t.changePwdConfig,"isModal",e)},close:function(e){t.cancelChangePwd()}}},[o("el-form",{ref:"changePwdConfig.opts",attrs:{model:t.changePwdConfig.opts,rules:t.changePwdConfigRules}},["Main"==t.changePwdConfig.type?o("el-form-item",{attrs:{prop:"oldPassword",label:"原密码","label-width":"100px"}},[o("el-input",{attrs:{type:"password",placeholder:"请填写","auto-complete":"off"},model:{value:t.changePwdConfig.opts.oldPassword,callback:function(e){t.$set(t.changePwdConfig.opts,"oldPassword",e)},expression:"changePwdConfig.opts.oldPassword"}})],1):t._e(),t._v(" "),o("el-form-item",{attrs:{label:"新密码","label-width":"100px",prop:"newPassword"}},[o("el-input",{attrs:{type:"password",placeholder:"请填写","auto-complete":"off"},model:{value:t.changePwdConfig.opts.newPassword,callback:function(e){t.$set(t.changePwdConfig.opts,"newPassword",e)},expression:"changePwdConfig.opts.newPassword"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"确认密码","label-width":"100px",prop:"confirmPassword"}},[o("el-input",{attrs:{type:"password",placeholder:"请填写","auto-complete":"off"},model:{value:t.changePwdConfig.opts.confirmPassword,callback:function(e){t.$set(t.changePwdConfig.opts,"confirmPassword",e)},expression:"changePwdConfig.opts.confirmPassword"}})],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.cancelChangePwd()}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitChangePwd("changePwdConfig.opts")}}},[t._v("确 定")])],1)],1)],1)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title"},[e("span",[this._v("账户与权限")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"section-title"},[e("span",[this._v("当前账号设置")])])}]};var d=o("VU/8")(a,r,!1,function(t){o("XtNR")},"data-v-9a8d6b08",null);e.default=d.exports}});
//# sourceMappingURL=32.8f8eefd4ac4dd908fecd.js.map